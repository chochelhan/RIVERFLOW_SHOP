import{a as w,E as V,F as U}from"./apiService-aee0d783.js";import{U as f}from"./util-5fdb7bcf.js";import{_ as D,r as u,o as l,c as a,a as i,F as g,b as h,t as c,g as S,e as k,d as p,w as I,u as R,p as E,f as C}from"./index-e9ed42ea.js";const F={props:["registData"],data(){return{form:null,util:f,oid:"",pid:"",grade:0,orderList:[],oidPidList:{},content:"",reviewImgs:[{isfile:"",file:null,url:""}],reviewImgIndex:0,pointMsg:""}},created(){this.oid=this.registData.oid,this.pid=this.registData.pid,this.getData()},methods:{getData(){w.post(V,{oid:this.oid,pid:this.pid},t=>{const s={};this.orderList=[];for(let e of t.data.goodsList){e.productprice=e.dcprice?e.dcprice:e.price,e.optionSingleDatas=[],e.optionSingleInfos&&(e.optionSingleDatas=JSON.parse(e.optionSingleInfos));let d=e.oid+"_"+e.pid;e.oidPid=d,!s[d]&&e.opt_name?(s[d]=[],s[d].push({name:e.opt_name,oamt:e.oamt}),this.orderList.push(e)):e.opt_name?s[d].push({name:e.opt_name,oamt:e.oamt}):this.orderList.push(e)}this.oidPidList=s,t.data.point&&t.data.point.oreplyPointUse&&t.data.point.oreplyPointUse=="yes"&&(this.pointMsg="후기작성시 포토후기는 "+f.numberFormat(t.data.point.oreplyPhotoPoint)+t.data.point.pointUnit+" 일반후기는 "+f.numberFormat(t.data.point.oreplyPoint)+t.data.point.pointUnit+" "+t.data.point.pointName+" 지급됩니다")})},reviewValidate(){if(!this.form)return;if(!this.pid||!this.oid){this.hide();return}if(!this.grade){let e={message:"평점을 선택해주세요"};this.emitter.emit("modalOpen",e);return}const t=new FormData;t.append("pid",this.pid),t.append("oid",this.oid),t.append("grade",this.grade),t.append("content",this.content);let s=1;for(const e of this.reviewImgs)e.file&&(t.append("img"+s,e.file),t.append("tempImgs[]",1),s++);this.emitter.emit("overlay","open"),w.postFile(U,t,e=>{if(this.emitter.emit("overlay","hide"),e.status=="success"){this.$emit("saveRegist",this.registData);let d={message:"구매후기가 등록되었습니다"};this.emitter.emit("modalOpen",d)}else{let d="";switch(e.data){case"is":d="이미 등록된 후기입니다";break;case"denyOstatus":d="후기등록권한이 존재하지 않습니다";break}let n={message:d};this.emitter.emit("modalOpen",n)}})},insertImg(t){this.reviewImgIndex=t,this.$refs.img.click()},deleteImg(t){this.reviewImgs.splice(t,1),this.reviewImgs.length<1&&this.reviewImgs.push({isfile:"",file:null,url:""})},imgUpload(){const t=this.$refs.img.files;let s=t.length>0?t[0]:null,e={isfile:"",file:s,url:URL.createObjectURL(s)};this.reviewImgs.splice(this.reviewImgIndex,1,e),this.reviewImgIndex<3&&this.reviewImgs.push({isfile:"",file:null,url:""}),this.$refs.img.value=""},hide(){this.$emit("hideEvent",{})}}},_=t=>(E("data-v-7b69d3e6"),t=t(),C(),t),O={class:"login-container"},M=_(()=>i("p",{class:"login-title"},"구매후기 작성하기",-1)),N={class:"order-body"},B={class:"img-box"},A=["src"],T={class:"product-info"},z={class:"info-ul"},G={key:0},j={style:{"font-weight":"bold"}},W={key:1},Y={style:{"font-weight":"bold"}},J={class:"price"},q={key:0,class:"single-option-box"},H=_(()=>i("div",{class:"single-title"},"추가옵션",-1)),K={class:"single-option-ul"},Q={class:"sopt-name"},X={key:0,class:"sopt-price"},Z={key:1,class:"sopt-soldout"},$={class:"grade-box"},ee=_(()=>i("div",{class:"gtitle",style:{"margin-top":"40px"}},"이상품은 어떠셨나요?",-1)),te={class:"w-full"},ie={class:"w-full",style:{padding:"20px 0"}},se={class:"detail-img-box"},oe={class:"add-detial-img-ul"},ne={class:"reg-img-box"},le={key:0,class:"is-img"},ae=["onClick"],de=["src"],re=["onClick"],ce={class:"guide-img-icon"},pe=_(()=>i("div",{class:"guide-img-size"},null,-1)),me={key:0,class:"tip"},_e={class:"button-row"},ue=_(()=>i("span",null,"취소",-1)),ge=_(()=>i("span",null,"확인",-1));function he(t,s,e,d,n,m){const x=u("v-rating"),P=u("v-textarea"),y=u("font-awesome-icon"),b=u("v-btn"),L=u("v-form");return l(),a("div",O,[M,i("ul",N,[(l(!0),a(g,null,h(n.orderList,o=>(l(),a("li",null,[i("div",B,[i("img",{src:o.listImg},null,8,A)]),i("div",T,[i("ul",z,[i("li",null,[n.oidPidList[o.oidPid]?(l(),a("div",G,[i("span",j,c(o.pname),1),(l(!0),a(g,null,h(n.oidPidList[o.oidPid],r=>(l(),a("div",null,c(r.name)+" ("+c(r.oamt)+"개) ",1))),256))])):(l(),a("div",W,[i("span",Y,c(o.pname),1),S(" ("+c(o.oamt)+"개) ",1)]))])]),i("div",J,c(n.util.numberFormat(o.productprice))+"원 ",1),o.optionSingleDatas.length>0?(l(),a("div",q,[H,i("ul",K,[(l(!0),a(g,null,h(o.optionSingleDatas,(r,v)=>(l(),a("li",{key:"spt"+v},[i("div",Q,c(r.option_parent_name)+":"+c(r.option_name),1),r.status=="sale"?(l(),a("div",X,[i("span",null,c(r.camt)+"개, "+c(n.util.numberFormat(r.sellprice))+"원 ",1)])):(l(),a("div",Z," [품절] "))]))),128))])])):k("",!0)])]))),256))]),p(L,{modelValue:n.form,"onUpdate:modelValue":s[4]||(s[4]=o=>n.form=o),novalidate:"",onSubmit:R(m.reviewValidate,["prevent"])},{default:I(()=>[i("div",$,[ee,p(x,{modelValue:n.grade,"onUpdate:modelValue":s[0]||(s[0]=o=>n.grade=o),hover:"",color:"#000000","background-color":"#999",length:5,size:40},null,8,["modelValue"])]),i("div",te,[i("div",ie,[p(P,{style:{"border-radius":"5px"},variant:"outlined",density:"compact",counter:"","no-resize":"",maxlength:"200",rules:[()=>!!n.content||"내용을 입력해주세요"],placeholder:"내용을 입력해주세요(최대200자)",modelValue:n.content,"onUpdate:modelValue":s[1]||(s[1]=o=>n.content=o)},null,8,["rules","modelValue"])]),i("div",se,[i("input",{type:"file",style:{display:"none"},ref:"img",accept:"image/*",onChange:s[2]||(s[2]=(...o)=>m.imgUpload&&m.imgUpload(...o))},null,544),i("ul",oe,[(l(!0),a(g,null,h(n.reviewImgs,(o,r)=>(l(),a("li",ne,[o.url?(l(),a("div",le,[i("div",{class:"is-img-close",onClick:v=>m.deleteImg(r)},[p(y,{icon:"fa-solid fa-xmark"})],8,ae),i("img",{src:o.url},null,8,de)])):(l(),a("div",{key:1,class:"guide-img",onClick:v=>m.insertImg(r)},[i("div",ce,[p(y,{icon:"fa-solid fa-plus"})]),pe],8,re))]))),256))])])]),n.pointMsg?(l(),a("div",me,c(n.pointMsg),1)):k("",!0),i("div",_e,[p(b,{type:"button",variant:"outlined",rounded:"",onClick:s[3]||(s[3]=o=>m.hide()),class:"whiteButton"},{default:I(()=>[ue]),_:1}),p(b,{type:"submit",variant:"outlined",rounded:"",class:"blackButton"},{default:I(()=>[ge]),_:1})])]),_:1},8,["modelValue","onSubmit"])])}const ye=D(F,[["render",he],["__scopeId","data-v-7b69d3e6"]]);export{ye as r};
