import{A as O,a as L,a7 as T,a8 as j,a9 as N,aa as E,a3 as J,ab as z}from"./apiService-aee0d783.js";import{a as G}from"./articleUpass-a374b16b.js";import{J as A}from"./jquery-331624d0.js";import{i as Q,m as x,_ as $,r as C,o as n,c as r,a as o,t as g,j as I,d as a,w as f,F as M,b as R,g as S,e as b,p as V,f as P}from"./index-e9ed42ea.js";import{m as K}from"./mobile-9de1c1d4.js";import{U as y}from"./util-5fdb7bcf.js";import{c as D}from"./config-2d27fdd7.js";import"./axios-c24e582b.js";const W={name:"pcCommentList",props:["auth","ptype","pid"],computed:{...Q(D,["listScrollMore"]),form(){return{comment:this.comment}}},watch:{listScrollMore(t){t&&this.handleLoadMore()}},data(){return{limit:10,page:1,lastPage:1,total:0,memberImg:"",isLogin:!1,commentList:[],comment:"",commentId:"",memberId:"",insertFlag:!1,formHasErrors:!1,subComment:[],subCommentError:[],subCommentUpdate:[],commentIndex:"",scrolling:!1,commentRepleShow:[]}},created(){const t=O.getSession();t&&(t!=null&&t.memberInfo)&&(this.memberId=t.memberInfo.id,this.isLogin=!0),this.getData()},methods:{...x(D,["setListScroll","setListScrollMore"]),getData(){this.scrolling=!0;const t=this.getSearchParams();L.get(T,t,e=>{var i;this.commentList=[],this.total=y.numberFormat(e.data.commentList.total),this.$emit("updateCommentCnt",{total:e.data.commentList.total}),this.setCommentList(e.data.commentList),this.isLogin&&(this.memberImg=(i=e.data.memberInfo)!=null&&i.img?e.data.memberInfo.img:"")})},getDataList(){this.scrolling=!0;const t=this.getSearchParams();L.get(T,t,e=>{this.setCommentList(e.data.commentList)})},setCommentList(t){this.lastPage=t.last_page;for(let e of t.data){e.viewName=e.memNick?e.memNick:e.memName,e.modifyButton=!!(this.isLogin&&this.memberId==e.user_id);for(let i of e.subList)i.viewName=i.memNick?i.memNick:i.memName,i.modifyButton=!!(this.isLogin&&this.memberId==i.user_id);this.commentList.push(e)}for(const e in this.commentList)this.subComment[e]="",this.subCommentError[e]="",this.subCommentUpdate[e]=!1,this.commentRepleShow[e]=!1;this.scrolling=!1,this.page<this.lastPage?(this.setListScroll(!0),this.setListScrollMore(!1)):this.setListScroll(!1)},getSearchParams(){return{parentType:this.ptype,parentId:this.pid,limit:this.limit,page:this.page}},setModify(t){if(this.subCommentId){const i={message:"기존 수정 작업을 먼저 완료하세요"};this.$eventBus.$emit("modalOpen",i);return}const e=this.commentList[t];this.comment=y.stripTags(e.content),this.commentId=e.id},showSubComment(t){for(const e in this.commentRepleShow)this.commentRepleShow[e]=!1;this.$set(this.commentRepleShow,t,!0)},setSubModify(t,e){if(this.commentId){const p={message:"기존 수정 작업을 먼저 완료하세요"};this.$eventBus.$emit("modalOpen",p);return}const i=this.commentList[t].subList[e];this.$set(this.subComment,t,y.stripTags(i.content)),this.subCommentId=i.id,this.commentIndex=t;for(const p in this.subCommentUpdate)this.subCommentUpdate[p]=!1;this.subCommentUpdate[t]=!0,this.showSubComment(t)},deleteComment(t){const e={type:"confirm",message:"댓글을 삭제하시겠습니까?",doAction:()=>{const i=this.commentList[t].id;this.blindAction(i,"main")}};this.$eventBus.$emit("modalOpen",e)},deleteSubComment(t,e){const i={type:"confirm",message:"답글을 삭제하시겠습니까?",doAction:()=>{const p=this.commentList[t].subList[e].id;this.blindAction(p,"sub")}};this.$eventBus.$emit("modalOpen",i)},blindAction(t,e){const i={id:t};this.$eventBus.$emit("overlay","open"),L.post(j,i,p=>{this.$eventBus.$emit("overlay","hide"),this.page=1,this.getData();const m={message:(e=="sub"?"답글":"댓글")+"이 삭제되었습니다"};this.$eventBus.$emit("modalOpen",m)})},reset(){this.commentId="",this.comment="",this.$refs.comment.reset()},subReset(t){this.subCommentId="";for(const e in this.subCommentUpdate)this.subCommentUpdate[e]=!1;this.subComment[t]="",this.$set(this.subCommentError,t,"")},subCommentErrorCheck(t){this.subComment[t]?this.$set(this.subCommentError,t,""):this.$set(this.subCommentError,t,"답글을 입력하세요")},updateSubReview(t){if(this.insertFlag)return;if(this.auth=="user"&&!this.isLogin){let s={message:"먼저 로그인 하세요"};this.$eventBus.$emit("modalOpen",s);return}if(!this.subComment[t]){this.$set(this.subCommentError,t,"답글을 입력하세요");return}this.insertFlag=!0,this.$eventBus.$emit("overlay","open");const e=this.commentList[t].id;let i="",p={parentId:this.pid,parentType:this.ptype,content:this.subComment[t],pid:e};this.subCommentId?(i=N,p.id=this.subCommentId):i=E,L.post(i,p,s=>{if(this.$eventBus.$emit("overlay","hide"),this.insertFlag=!1,this.subCommentId){let u=0,d={};for(let k of this.commentList[this.commentIndex].subList){if(k.id==this.subCommentId){k.content=y.nl2brContent(this.subComment[t]),d=k;break}u++}this.$set(this.commentList[this.commentIndex].subList,d,u);for(const k in this.commentRepleShow)this.commentRepleShow[k]=!1}else this.page=1,this.getData();const h={message:"답글이 "+(this.subCommentId?"수정":"저장")+" 되었습니다"};this.subReset(this.commentIndex),this.commentIndex="",this.$eventBus.$emit("modalOpen",h)})},updateReview(){if(this.insertFlag)return;if(this.auth=="user"&&!this.isLogin){let i={message:"먼저 로그인 하세요"};this.$eventBus.$emit("modalOpen",i);return}if(this.formHasErrors=!1,Object.keys(this.form).forEach(i=>{this.form[i]||(this.formHasErrors=!0),this.$refs[i].validate(!0)}),this.formHasErrors)return;this.insertFlag=!0,this.$eventBus.$emit("overlay","open");let t="",e={parentId:this.pid,parentType:this.ptype,content:this.comment};this.commentId?(t=N,e.id=this.commentId):t=E,L.post(t,e,i=>{if(this.$eventBus.$emit("overlay","hide"),this.insertFlag=!1,this.commentId){let m=0,h={};for(let u of this.commentList){if(u.id==this.commentId){u.content=y.nl2brContent(this.comment),h=u;break}m++}this.$set(this.commentList,h,m)}else this.page=1,this.getData();const s={message:"댓글이 "+(this.commentId?"수정":"저장")+" 되었습니다"};this.commentId="",this.comment="",this.$refs.comment.reset(),this.$eventBus.$emit("modalOpen",s)})},handleLoadMore(){this.page<this.lastPage&&(this.page++,this.getDataList())}},destroyed(){this.setListScroll(!1)}},B=t=>(V("data-v-74788f5f"),t=t(),P(),t),X={class:"comment-container",id:"comment-base"},Y={class:"comment-title"},Z={class:"form-box"},tt={class:"img-box"},et=["src"],st={class:"input-box",id:"c"},ot={key:0,class:"button-box"},it={class:"comment-box"},nt={class:"main-comment-ul"},mt=["id"],rt={class:"main-comment"},at={class:"user-box"},ct={class:"img-box"},lt=["src"],dt={class:"uname"},ht={class:"content-box"},ut=["innerHTML"],_t={class:"rdate"},ft={class:"modify-button-box"},pt=B(()=>o("span",null,"답글달기",-1)),bt=B(()=>o("span",null,"삭제",-1)),gt=B(()=>o("span",null,"수정",-1)),vt={key:0,class:"sub-comment"},yt={key:0,class:"sub-form-box"},Ct={class:"img-box"},It=["src"],kt={class:"input-box"},Lt={key:0,class:"button-box"},wt={key:1,class:"sub-comment-ul"},St=["id"],$t={class:"user-box"},Bt={class:"img-box"},Ut=["src"],Tt={class:"uname"},Nt={class:"content-box"},Et=["innerHTML"],At={class:"rdate"},Mt={key:0,class:"modify-button-box"},Rt=B(()=>o("span",null,"삭제",-1)),Dt=B(()=>o("span",null,"수정",-1)),Ot={key:0,style:{"text-align":"center",padding:"200px 0"}};function Vt(t,e,i,p,s,m){const h=C("font-awesome-icon"),u=C("v-text-field"),d=C("v-btn"),k=C("v-progress-circular");return n(),r("div",X,[o("div",Y,"댓글 ("+g(s.total)+")",1),o("div",Z,[o("div",tt,[s.memberImg?(n(),r("img",{key:0,src:s.memberImg},null,8,et)):(n(),I(h,{key:1,class:"icon",icon:"fa-solid fa-user"}))]),o("div",st,[a(u,{ref:"comment",modelValue:s.comment,"onUpdate:modelValue":e[0]||(e[0]=_=>s.comment=_),outlined:"",dense:"",maxLength:"250",rules:[()=>!!s.comment||"댓글을 입력하세요"]},null,8,["modelValue","rules"])]),s.commentId?(n(),r("div",ot,[a(d,{class:"blackButton",onClick:e[1]||(e[1]=_=>m.updateReview()),rounded:"",depressed:""},{default:f(()=>[a(h,{class:"icon",icon:"fa-solid fa-paper-plane"})]),_:1}),a(d,{class:"whiteButton",onClick:e[2]||(e[2]=_=>m.reset()),rounded:"",depressed:""},{default:f(()=>[a(h,{class:"icon",icon:"fa-solid fa-ban"})]),_:1})])):(n(),I(d,{key:1,class:"blackButton",onClick:e[3]||(e[3]=_=>m.updateReview()),rounded:"",depressed:""},{default:f(()=>[a(h,{class:"icon",icon:"fa-solid fa-paper-plane"})]),_:1}))]),o("div",it,[o("ul",nt,[(n(!0),r(M,null,R(s.commentList,(_,c)=>(n(),r("li",{key:_.id,id:"comment_"+_.id},[o("div",rt,[o("div",at,[o("div",ct,[_.memImg?(n(),r("img",{key:0,src:_.memImg},null,8,lt)):(n(),I(h,{key:1,class:"icon",icon:"fa-solid fa-user"}))]),o("div",dt,g(_.viewName),1)]),o("div",ht,[o("div",{class:"content",innerHTML:_.content},null,8,ut),o("div",_t,[S(g(_.created_at.substring(0,10))+" ",1),o("div",ft,[a(d,{class:"whiteButton reple",onClick:l=>m.showSubComment(c),depressed:"",rounded:""},{default:f(()=>[pt]),_:2},1032,["onClick"]),_.modifyButton?(n(),I(d,{key:0,class:"whiteButton",onClick:l=>m.deleteComment(c),depressed:"",rounded:""},{default:f(()=>[bt]),_:2},1032,["onClick"])):b("",!0),_.modifyButton?(n(),I(d,{key:1,class:"blackButton",onClick:l=>m.setModify(c),depressed:"",rounded:""},{default:f(()=>[gt]),_:2},1032,["onClick"])):b("",!0)])])])]),_.subList.length>0||s.commentRepleShow[c]?(n(),r("div",vt,[s.commentRepleShow[c]?(n(),r("div",yt,[o("div",Ct,[s.memberImg?(n(),r("img",{key:0,src:s.memberImg},null,8,It)):(n(),I(h,{key:1,class:"icon",icon:"fa-solid fa-user"}))]),o("div",kt,[a(u,{"error-messages":s.subCommentError[c],modelValue:s.subComment[c],"onUpdate:modelValue":l=>s.subComment[c]=l,outlined:"",dense:"",maxLength:"150",onInput:l=>m.subCommentErrorCheck(c),onBlur:l=>m.subCommentErrorCheck(c)},null,8,["error-messages","modelValue","onUpdate:modelValue","onInput","onBlur"])]),s.subCommentUpdate[c]?(n(),r("div",Lt,[a(d,{class:"blackButton",onClick:l=>m.updateSubReview(c),rounded:"",depressed:""},{default:f(()=>[a(h,{class:"icon",icon:"fa-solid fa-paper-plane"})]),_:2},1032,["onClick"]),a(d,{class:"whiteButton",onClick:l=>m.subReset(c),rounded:"",depressed:""},{default:f(()=>[a(h,{class:"icon",icon:"fa-solid fa-ban"})]),_:2},1032,["onClick"])])):(n(),I(d,{key:1,class:"blackButton",onClick:l=>m.updateSubReview(c),rounded:"",depressed:""},{default:f(()=>[a(h,{class:"icon",icon:"fa-solid fa-paper-plane"})]),_:2},1032,["onClick"]))])):b("",!0),_.subList.length>0?(n(),r("ul",wt,[(n(!0),r(M,null,R(_.subList,(l,v)=>(n(),r("li",{key:l.id,id:"comment_"+l.id},[o("div",$t,[o("div",Bt,[l.memImg?(n(),r("img",{key:0,src:l.memImg},null,8,Ut)):(n(),I(h,{key:1,class:"icon",icon:"fa-solid fa-user"}))]),o("div",Tt,g(l.viewName),1)]),o("div",Nt,[o("div",{class:"content",innerHTML:l.content},null,8,Et),o("div",At,[S(g(l.created_at.substring(0,10))+" ",1),l.modifyButton?(n(),r("div",Mt,[a(d,{class:"whiteButton",onClick:U=>m.deleteSubComment(c,v),depressed:"",rounded:""},{default:f(()=>[Rt]),_:2},1032,["onClick"]),a(d,{class:"blackButton",onClick:U=>m.setSubModify(c,v),depressed:"",rounded:""},{default:f(()=>[Dt]),_:2},1032,["onClick"])])):b("",!0)])])],8,St))),128))])):b("",!0)])):b("",!0)],8,mt))),128))])]),s.scrolling?(n(),r("div",Ot,[a(k,{size:80,color:"#AD1457",indeterminate:""})])):b("",!0)])}const Pt=$(W,[["render",Vt],["__scopeId","data-v-74788f5f"]]);const xt={components:{articleUpassComponent:G,commentList:Pt},data(){return{util:y,passDialogShow:!1,bid:"",id:"",categoryNames:{},info:{},boardInfo:{},owner:!1,userName:"",memberInfo:{},replyShow:!1,upassType:"modify",commentCnt:0}},created(){this.setClass("sub"),this.setTitle("게시글 상세보기"),this.id=this.$route.params.id,this.bid=this.$route.params.bid;const t=O.getSession();t&&(t!=null&&t.memberInfo)&&(this.memberInfo=t.memberInfo,this.isLogin=!0),this.getData()},methods:{...x(K,["setClass","setTitle"]),getData(){const t={id:this.id,bid:this.bid,type:"view"};L.get(J,t,e=>{if(this.boardInfo=e.data.boardInfo,this.boardInfo.categoryUse=="yes")for(const i of JSON.parse(this.boardInfo.categoryList))this.categoryNames[i.code]=i.name;this.info=e.data.articleInfo,e.data.memberset&&e.data.memberset.nickUse=="yes"&&this.info.nick?this.userName=this.info.nick:this.info.name?this.userName=this.info.name:this.userName=this.info.user_name,this.boardInfo.replyUse=="yes"&&(this.replyShow=!0),this.info.hit=this.info.hit?y.numberFormat(this.info.hit):0,this.info.created_at=this.info.created_at.substring(0,16).replace("T"," "),this.info.secret=="yes"?this.boardInfo.wauth=="all"?this.owner=!0:this.info.user_id&&this.info.user_id==this.memberInfo.id&&(this.owner=!0):this.info.user_id&&this.info.user_id==this.memberInfo.id?this.owner=!0:!this.info.user_id&&this.boardInfo.wauth=="all"&&(this.owner=!0)})},modifyItem(){this.info.secret!="yes"&&!this.info.user_id&&this.boardInfo.wauth=="all"?(this.upassType="modify",this.passDialogShow=!0):this.$router.push("/board/articleRegist/"+this.bid+"/"+this.id)},deleteItem(){if(this.info.secret!="yes"&&!this.info.user_id&&this.boardInfo.wauth=="all")this.upassType="delete",this.passDialogShow=!0;else{const t={type:"confirm",message:"게시글을 삭제 하시겠습니까?",doAction:()=>{this.deleteAction()}};this.emitter.emit("modalOpen",t)}},delAction(t){this.deleteAction()},deleteAction(){const t={id:this.id,bid:this.bid};L.post(z,t,e=>{const i={message:"게시글이 삭제 되었습니다",doAction:()=>{this.$router.push("/board/articleList/"+this.bid)}};this.emitter.emit("modalOpen",i)})},updateCommentCnt(t){this.commentCnt=y.numberFormat(t.total)}},updated(){A(".content img").css("max-width","100%"),A(".content p").css({"line-height":"130%",margin:0})}},F=t=>(V("data-v-65686c10"),t=t(),P(),t),Ft={class:"page-container"},Ht={class:"article-container"},jt={class:"article-info"},Jt={class:"bsubject"},zt={key:0,class:"category"},Gt={key:1},Qt={class:"summary"},qt={key:0},Kt={key:0,class:"img"},Wt=["src"],Xt=["innerHTML"],Yt={key:1,class:"modify-box"},Zt=F(()=>o("span",null,"수정",-1)),te=F(()=>o("span",null,"삭제",-1)),ee={class:"button-row"},se=F(()=>o("span",null,"목록으로",-1));function oe(t,e,i,p,s,m){const h=C("font-awesome-icon"),u=C("v-btn"),d=C("commentList"),k=C("articleUpassComponent");return n(),r("div",Ft,[o("div",Ht,[o("ul",jt,[o("li",Jt,[s.info.category?(n(),r("span",zt,"["+g(s.categoryNames[s.info.category])+"]",1)):b("",!0),S(" "+g(s.info.subject)+" ",1),s.info.secret=="yes"?(n(),r("span",Gt,[a(h,{icon:"fa-solid fa-lock"})])):b("",!0)]),o("li",Qt,[o("div",null,[o("span",null,"작성자 : "+g(s.userName),1),s.replyShow?(n(),r("span",qt,"댓글수 : "+g(s.commentCnt),1)):b("",!0),o("span",null,"조회수 : "+g(s.info.hit),1),o("div",null,"등록일 : "+g(s.info.created_at),1)])])]),s.info.img?(n(),r("div",Kt,[o("img",{src:s.info.img},null,8,Wt)])):b("",!0),o("div",{innerHTML:s.info.content,class:"content"},null,8,Xt),s.owner?(n(),r("div",Yt,[a(u,{class:"white-button",onClick:e[0]||(e[0]=_=>m.modifyItem()),variant:"outlined"},{default:f(()=>[Zt]),_:1}),a(u,{class:"red-button",onClick:e[1]||(e[1]=_=>m.deleteItem()),variant:"outlined"},{default:f(()=>[te]),_:1})])):b("",!0),o("div",ee,[a(u,{onClick:e[2]||(e[2]=_=>t.$router.back()),class:"whiteButton",variant:"outlined",rounded:"",type:"button"},{default:f(()=>[se]),_:1})]),s.replyShow?(n(),I(d,{key:2,auth:s.boardInfo.rauth,ptype:"board",onUpdateCommentCnt:m.updateCommentCnt,pid:s.id},null,8,["auth","onUpdateCommentCnt","pid"])):b("",!0)]),a(k,{bid:s.bid,articleId:s.id,type:s.upassType,modelOpen:s.passDialogShow,onUpassSuccess:m.delAction,onParentOpenFalse:e[3]||(e[3]=_=>s.passDialogShow=!1)},null,8,["bid","articleId","type","modelOpen","onUpassSuccess"])])}const ie=$(xt,[["render",oe],["__scopeId","data-v-65686c10"]]);const ne={name:"pcCommentList",props:["auth","ptype","pid"],computed:{...Q(D,["listScrollMore"])},watch:{listScrollMore(t){t&&this.handleLoadMore()}},data(){return{limit:10,page:1,lastPage:1,total:0,memberImg:"",isLogin:!1,commentList:[],comment:"",commentId:"",memberId:"",insertFlag:!1,formHasErrors:!1,subComment:[],subCommentError:[],subCommentUpdate:[],subCommentId:"",commentIndex:"",scrolling:!1}},created(){const t=O.getSession();t&&(t!=null&&t.memberInfo)&&(this.memberId=t.memberInfo.id,this.isLogin=!0),this.getData()},methods:{...x(D,["setListScroll","setListScrollMore"]),getData(){this.scrolling=!0;const t=this.getSearchParams();L.get(T,t,e=>{var i;this.commentList=[],this.total=y.numberFormat(e.data.commentList.total),this.$emit("updateCommentCnt",{total:e.data.commentList.total}),this.setCommentList(e.data.commentList),this.isLogin&&(this.memberImg=(i=e.data.memberInfo)!=null&&i.img?e.data.memberInfo.img:"")})},getDataList(){this.scrolling=!0;const t=this.getSearchParams();L.get(T,t,e=>{this.setCommentList(e.data.commentList)})},setCommentList(t){this.lastPage=t.last_page;for(let e of t.data){e.viewName=e.memNick?e.memNick:e.memName,e.modifyButton=!!(this.isLogin&&this.memberId==e.user_id);for(let i of e.subList)i.viewName=i.memNick?i.memNick:i.memName,i.modifyButton=!!(this.isLogin&&this.memberId==i.user_id);e.repleShow=!1,this.commentList.push(e)}for(const e in this.commentList)this.subComment[e]="",this.subCommentError[e]="",this.subCommentUpdate[e]=!1;this.scrolling=!1,this.page<this.lastPage?(this.setListScroll(!0),this.setListScrollMore(!1)):this.setListScroll(!1)},getSearchParams(){return{parentType:this.ptype,parentId:this.pid,limit:this.limit,page:this.page}},showRepleBox(t){if(!this.subCommentId)for(let e in this.commentList)t==e?this.commentList[e].repleShow?this.commentList[e].repleShow=!1:this.commentList[e].repleShow=!0:this.commentList[e].repleShow=!1},setModify(t){if(this.subCommentId){const i={message:"기존 수정 작업을 먼저 완료하세요"};this.emitter.emit("modalOpen",i);return}const e=this.commentList[t];this.comment=y.stripTags(e.content),this.commentId=e.id,y.errorPosition("base","#comment-base",()=>{})},setSubModify(t,e){if(this.commentId){const p={message:"기존 수정 작업을 먼저 완료하세요"};this.emitter.emit("modalOpen",p);return}this.commentList[t].repleShow=!0;const i=this.commentList[t].subList[e];this.subComment[t]=y.stripTags(i.content),this.subCommentId=i.id,this.commentIndex=t;for(const p in this.subCommentUpdate)this.subCommentUpdate[p]=!1;this.subCommentUpdate[t]=!0,y.errorPosition("base","#comment_"+this.commentList[t].id,()=>{})},deleteComment(t){const e={type:"confirm",message:"댓글을 삭제하시겠습니까?",doAction:()=>{const i=this.commentList[t].id;this.blindAction(i,"main")}};this.emitter.emit("modalOpen",e)},deleteSubComment(t,e){const i={type:"confirm",message:"답글을 삭제하시겠습니까?",doAction:()=>{const p=this.commentList[t].subList[e].id;this.blindAction(p,"sub")}};this.emitter.emit("modalOpen",i)},blindAction(t,e){const i={id:t};this.emitter.emit("overlay","open"),L.post(j,i,p=>{this.emitter.emit("overlay","hide"),this.page=1,this.getData();const m={message:(e=="sub"?"답글":"댓글")+"이 삭제되었습니다"};this.emitter.emit("modalOpen",m)})},reset(){this.commentId="",this.comment="",this.$refs.comment.reset()},subReset(t){this.subCommentId="";for(const e in this.subCommentUpdate)this.subCommentUpdate[e]=!1;this.subComment[t]="",this.subCommentError[t]=""},subCommentErrorCheck(t){this.subComment[t]?this.subCommentError[t]="":this.subCommentError[t]="답글을 입력하세요"},updateSubReview(t){if(this.insertFlag)return;if(this.auth=="user"&&!this.isLogin){let s={message:"먼저 로그인 하세요"};this.emitter.emit("modalOpen",s);return}if(!this.subComment[t]){this.subCommentError[t]="답글을 입력하세요";return}this.insertFlag=!0,this.emitter.emit("overlay","open");const e=this.commentList[t].id;let i="",p={parentId:this.pid,parentType:this.ptype,content:this.subComment[t],pid:e};this.subCommentId?(i=N,p.id=this.subCommentId):i=E,L.post(i,p,s=>{if(this.emitter.emit("overlay","hide"),this.insertFlag=!1,this.subCommentId){let u=0,d={};for(let k of this.commentList[this.commentIndex].subList){if(k.id==this.subCommentId){k.content=y.nl2brContent(this.subComment[t]),d=k;break}u++}this.commentList[this.commentIndex].subList[u]=d,y.errorPosition("base","#comment_"+this.subCommentId,()=>{})}else this.page=1,this.getData();const h={message:"답글이 "+(this.subCommentId?"수정":"저장")+" 되었습니다"};this.subReset(this.commentIndex),this.commentIndex="",this.emitter.emit("modalOpen",h)})},updateReview(){if(this.insertFlag)return;if(this.auth=="user"&&!this.isLogin){let i={message:"먼저 로그인 하세요"};this.emitter.emit("modalOpen",i);return}if(this.formHasErrors=!1,Object.keys(this.form).forEach(i=>{this.form[i]||(this.formHasErrors=!0),this.$refs[i].validate(!0)}),this.formHasErrors)return;this.insertFlag=!0,this.emitter.emit("overlay","open");let t="",e={parentId:this.pid,parentType:this.ptype,content:this.comment};this.commentId?(t=N,e.id=this.commentId):t=E,L.post(t,e,i=>{if(this.emitter.emit("overlay","hide"),this.insertFlag=!1,this.commentId){let m=0,h={};for(let u of this.commentList){if(u.id==this.commentId){u.content=y.nl2brContent(this.comment),h=u;break}m++}this.commentList[m]=h,y.errorPosition("base","#comment_"+this.commentId,()=>{})}else this.page=1,this.getData();const s={message:"댓글이 "+(this.commentId?"수정":"저장")+" 되었습니다"};this.commentId="",this.comment="",this.$refs.comment.reset(),this.emitter.emit("modalOpen",s)})},handleLoadMore(){this.page<this.lastPage&&(this.page++,this.getDataList())}},destroyed(){this.setListScroll(!1)}},w=t=>(V("data-v-85b9f75d"),t=t(),P(),t),me={class:"comment-container",id:"comment-base"},re={class:"comment-title"},ae={class:"form-box"},ce={class:"img-box"},le=["src"],de={class:"input-box",id:"c"},he={key:0,class:"button-box"},ue=w(()=>o("span",null,"댓글 수정",-1)),_e=w(()=>o("span",null,"취소",-1)),fe=w(()=>o("span",null,"댓글 저장",-1)),pe={class:"comment-box"},be={class:"main-comment-ul"},ge=["id"],ve={class:"main-comment"},ye={class:"user-box"},Ce={class:"img-box"},Ie=["src"],ke={class:"uname"},Le={class:"content"},we=["innerHTML"],Se=["onClick"],$e={class:"rdate"},Be={key:0,class:"modify-button-box"},Ue=w(()=>o("span",null,"삭제",-1)),Te=w(()=>o("span",null,"수정",-1)),Ne={key:0,class:"sub-comment"},Ee={key:0,class:"form-box"},Ae={class:"img-box"},Me=["src"],Re={class:"input-box"},De={key:0,class:"button-box"},Oe=w(()=>o("span",null,"답글 수정",-1)),Ve=w(()=>o("span",null,"취소",-1)),Pe=w(()=>o("span",null,"답글 저장",-1)),xe={class:"sub-comment-ul"},Fe=["id"],He={class:"user-box"},je={class:"img-box"},Je=["src"],ze={class:"uname"},Ge=["innerHTML"],Qe={class:"rdate"},qe={key:0,class:"modify-button-box"},Ke=w(()=>o("span",null,"삭제",-1)),We=w(()=>o("span",null,"수정",-1)),Xe={key:0,style:{"text-align":"center",padding:"200px 0"}};function Ye(t,e,i,p,s,m){const h=C("font-awesome-icon"),u=C("v-textarea"),d=C("v-btn"),k=C("v-text-field"),_=C("v-progress-circular");return n(),r("div",me,[o("div",re,"댓글 ("+g(s.total)+")",1),o("div",ae,[o("div",ce,[s.memberImg?(n(),r("img",{key:0,src:s.memberImg},null,8,le)):(n(),I(h,{key:1,class:"icon",icon:"fa-solid fa-user"}))]),o("div",de,[a(u,{ref:"comment",modelValue:s.comment,"onUpdate:modelValue":e[0]||(e[0]=c=>s.comment=c),outlined:"",dense:"",rows:"2",maxLength:"250","no-resize":"",rules:[()=>!!s.comment||"댓글을 입력하세요"]},null,8,["modelValue","rules"])]),s.commentId?(n(),r("div",he,[a(d,{class:"blackButton",onClick:e[1]||(e[1]=c=>m.updateReview()),depressed:""},{default:f(()=>[ue]),_:1}),a(d,{class:"whiteButton",onClick:e[2]||(e[2]=c=>m.reset()),depressed:""},{default:f(()=>[_e]),_:1})])):(n(),I(d,{key:1,class:"blackButton",onClick:e[3]||(e[3]=c=>m.updateReview()),depressed:""},{default:f(()=>[fe]),_:1}))]),o("div",pe,[o("ul",be,[(n(!0),r(M,null,R(s.commentList,(c,l)=>(n(),r("li",{key:c.id,id:"comment_"+c.id},[o("div",ve,[o("div",ye,[o("div",Ce,[c.memImg?(n(),r("img",{key:0,src:c.memImg},null,8,Ie)):(n(),I(h,{key:1,class:"icon",icon:"fa-solid fa-user"}))]),o("div",ke,g(c.viewName),1)]),o("div",Le,[o("div",{innerHTML:c.content},null,8,we),o("div",{class:"reply-action-text",onClick:v=>m.showRepleBox(l)}," 답글달기 ",8,Se)]),o("div",$e,[S(g(c.created_at.substring(0,10))+" ",1),c.modifyButton?(n(),r("div",Be,[a(d,{class:"whiteButton",onClick:v=>m.deleteComment(l),depressed:"",rounded:""},{default:f(()=>[Ue]),_:2},1032,["onClick"]),a(d,{class:"blackButton",onClick:v=>m.setModify(l),depressed:"",rounded:""},{default:f(()=>[Te]),_:2},1032,["onClick"])])):b("",!0)])]),c.subList.length>0||c.repleShow?(n(),r("div",Ne,[c.repleShow?(n(),r("div",Ee,[o("div",Ae,[s.memberImg?(n(),r("img",{key:0,src:s.memberImg},null,8,Me)):(n(),I(h,{key:1,class:"icon",icon:"fa-solid fa-user"}))]),o("div",Re,[a(k,{"error-messages":s.subCommentError[l],dense:"",modelValue:s.subComment[l],"onUpdate:modelValue":v=>s.subComment[l]=v,outlined:"",maxLength:"150",onInput:v=>m.subCommentErrorCheck(l),onBlur:v=>m.subCommentErrorCheck(l)},null,8,["error-messages","modelValue","onUpdate:modelValue","onInput","onBlur"])]),s.subCommentUpdate[l]?(n(),r("div",De,[a(d,{class:"blackButton",onClick:v=>m.updateSubReview(l),depressed:""},{default:f(()=>[Oe]),_:2},1032,["onClick"]),a(d,{class:"whiteButton",onClick:v=>m.subReset(l),depressed:""},{default:f(()=>[Ve]),_:2},1032,["onClick"])])):(n(),I(d,{key:1,class:"blackButton",onClick:v=>m.updateSubReview(l),depressed:""},{default:f(()=>[Pe]),_:2},1032,["onClick"]))])):b("",!0),o("ul",xe,[(n(!0),r(M,null,R(c.subList,(v,U)=>(n(),r("li",{key:v.id,id:"comment_"+v.id},[o("div",He,[o("div",je,[v.memImg?(n(),r("img",{key:0,src:v.memImg},null,8,Je)):(n(),I(h,{key:1,class:"icon",icon:"fa-solid fa-user"}))]),o("div",ze,g(v.viewName),1)]),o("div",{class:"content",innerHTML:v.content},null,8,Ge),o("div",Qe,[S(g(v.created_at.substring(0,10))+" ",1),v.modifyButton?(n(),r("div",qe,[a(d,{class:"whiteButton",onClick:q=>m.deleteSubComment(l,U),depressed:"",rounded:""},{default:f(()=>[Ke]),_:2},1032,["onClick"]),a(d,{class:"blackButton",onClick:q=>m.setSubModify(l,U),depressed:"",rounded:""},{default:f(()=>[We]),_:2},1032,["onClick"])])):b("",!0)])],8,Fe))),128))])])):b("",!0)],8,ge))),128))])]),s.scrolling?(n(),r("div",Xe,[a(_,{size:80,color:"#AD1457",indeterminate:""})])):b("",!0)])}const Ze=$(ne,[["render",Ye],["__scopeId","data-v-85b9f75d"]]);const ts={components:{articleUpassComponent:G,commentList:Ze},data(){return{passDialogShow:!1,bid:"",id:"",util:y,categoryNames:{},info:{},boardInfo:{},owner:!1,userName:"",memberInfo:{},replyShow:!1,upassType:"modify",commentCnt:0}},created(){this.id=this.$route.params.id,this.bid=this.$route.params.bid;const t=O.getSession();t&&(t!=null&&t.memberInfo)&&(this.memberInfo=t.memberInfo,this.isLogin=!0),this.getData()},methods:{getData(){const t={id:this.id,bid:this.bid,type:"view"};L.get(J,t,e=>{if(this.boardInfo=e.data.boardInfo,this.boardInfo.categoryUse=="yes")for(const i of JSON.parse(this.boardInfo.categoryList))this.categoryNames[i.code]=i.name;this.boardInfo.replyUse=="yes"&&(this.replyShow=!0),this.info=e.data.articleInfo,e.data.memberset&&e.data.memberset.nickUse=="yes"&&this.info.nick?this.userName=this.info.nick:this.info.name?this.userName=this.info.name:this.userName=this.info.user_name,this.info.hit=this.info.hit?y.numberFormat(this.info.hit):0,this.info.created_at=this.info.created_at.substring(0,16).replace("T"," "),this.info.secret=="yes"?this.boardInfo.wauth=="all"?this.owner=!0:this.info.user_id&&this.info.user_id==this.memberInfo.id&&(this.owner=!0):this.info.user_id&&this.info.user_id==this.memberInfo.id?this.owner=!0:!this.info.user_id&&this.boardInfo.wauth=="all"&&(this.owner=!0)})},modifyItem(){this.info.secret!="yes"&&!this.info.user_id&&this.boardInfo.wauth=="all"?(this.upassType="modify",this.passDialogShow=!0):this.$router.push("/board/articleRegist/"+this.bid+"/"+this.id)},deleteItem(){if(this.info.secret!="yes"&&!this.info.user_id&&this.boardInfo.wauth=="all")this.upassType="delete",this.passDialogShow=!0;else{const t={type:"confirm",message:"게시글을 삭제 하시겠습니까?",doAction:()=>{this.deleteAction()}};this.emitter.emit("modalOpen",t)}},delAction(t){this.deleteAction()},updateCommentCnt(t){this.commentCnt=y.numberFormat(t.total)},deleteAction(){const t={id:this.id,bid:this.bid};L.post(z,t,e=>{const i={message:"게시글이 삭제 되었습니다",doAction:()=>{this.$router.push("/board/articleList/"+this.bid)}};this.emitter.emit("modalOpen",i)})}},updated(){A(".content img").css("max-width","100%"),A(".content p").css({"line-height":"130%",margin:0})}},H=t=>(V("data-v-8c96ac35"),t=t(),P(),t),es={class:"page-container"},ss={class:"article-container"},os={class:"article-info"},is={class:"bname"},ns={class:"bsubject"},ms={key:0,class:"category"},rs={key:1},as={class:"summary"},cs={key:0},ls={key:0},ds=H(()=>o("span",null,"수정",-1)),hs=H(()=>o("span",null,"삭제",-1)),us={key:0,class:"img"},_s=["src"],fs=["innerHTML"],ps={class:"button-row"},bs=H(()=>o("span",null,"목록으로",-1));function gs(t,e,i,p,s,m){const h=C("font-awesome-icon"),u=C("v-btn"),d=C("commentList"),k=C("articleUpassComponent");return n(),r("div",es,[o("div",ss,[o("ul",os,[o("li",is,g(s.boardInfo.bname),1),o("li",ns,[s.info.category?(n(),r("span",ms,"["+g(s.categoryNames[s.info.category])+"]",1)):b("",!0),S(" "+g(s.info.subject)+" ",1),s.info.secret=="yes"?(n(),r("span",rs,[a(h,{icon:"fa-solid fa-lock"})])):b("",!0)]),o("li",as,[o("div",null,[o("span",null,"작성자 : "+g(s.userName),1),s.replyShow?(n(),r("span",cs,"댓글수 : "+g(s.commentCnt),1)):b("",!0),o("span",null,"조회수 : "+g(s.info.hit),1),o("span",null,"등록일 : "+g(s.info.created_at),1)]),s.owner?(n(),r("div",ls,[a(u,{class:"white-button",onClick:e[0]||(e[0]=_=>m.modifyItem()),variant:"tonal"},{default:f(()=>[ds]),_:1}),a(u,{class:"red-button",onClick:e[1]||(e[1]=_=>m.deleteItem()),variant:"tonal"},{default:f(()=>[hs]),_:1})])):b("",!0)])]),s.info.img?(n(),r("div",us,[o("img",{src:s.info.img},null,8,_s)])):b("",!0),o("div",{innerHTML:s.info.content,class:"content"},null,8,fs),o("div",ps,[a(u,{onClick:e[2]||(e[2]=_=>t.$router.back()),class:"whiteButton",variant:"outlined",rounded:"",type:"button"},{default:f(()=>[bs]),_:1})]),s.replyShow?(n(),I(d,{key:1,auth:s.boardInfo.rauth,ptype:"board",onUpdateCommentCnt:m.updateCommentCnt,pid:s.id},null,8,["auth","onUpdateCommentCnt","pid"])):b("",!0)]),a(k,{bid:s.bid,articleId:s.id,type:s.upassType,modelOpen:s.passDialogShow,onUpassSuccess:m.delAction,onParentOpenFalse:e[3]||(e[3]=_=>s.passDialogShow=!1)},null,8,["bid","articleId","type","modelOpen","onUpassSuccess"])])}const vs=$(ts,[["render",gs],["__scopeId","data-v-8c96ac35"]]);const ys={components:{mobileArticleView:ie,pcArticleView:vs},data(){return{mobile:!1}},created(){this.mobile=this.$isMobile()}},Cs={class:"page-container"};function Is(t,e,i,p,s,m){const h=C("mobileArticleView"),u=C("pcArticleView");return n(),r("div",Cs,[s.mobile?(n(),I(h,{key:0})):(n(),I(u,{key:1}))])}const Ns=$(ys,[["render",Is],["__scopeId","data-v-b9c3b3b4"]]);export{Ns as default};
