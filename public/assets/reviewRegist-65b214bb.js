import{a as w,E as V,F as U}from"./apiService-aee0d783.js";import{U as v}from"./util-5fdb7bcf.js";import{_ as S,r as u,o as l,c as a,a as i,F as h,b as g,d as p,w as I,u as R,t as c,g as E,e as k,p as D,f as C}from"./index-e9ed42ea.js";import"./axios-c24e582b.js";import"./jquery-331624d0.js";const F={data(){return{form:null,util:v,oid:"",pid:"",grade:0,orderList:[],oidPidList:{},content:"",reviewImgs:[{isfile:"",file:null,url:""}],reviewImgIndex:0,pointMsg:""}},created(){this.oid=this.$route.params.oid,this.pid=this.$route.params.pid,this.getData()},methods:{getData(){w.post(V,{oid:this.oid,pid:this.pid},t=>{const s={};this.orderList=[];for(let e of t.data.goodsList){e.productprice=e.dcprice?e.dcprice:e.price,e.optionSingleDatas=[],e.optionSingleInfos&&(e.optionSingleDatas=JSON.parse(e.optionSingleInfos));let d=e.oid+"_"+e.pid;e.oidPid=d,!s[d]&&e.opt_name?(s[d]=[],s[d].push({name:e.opt_name,oamt:e.oamt}),this.orderList.push(e)):e.opt_name?s[d].push({name:e.opt_name,oamt:e.oamt}):this.orderList.push(e)}this.oidPidList=s,t.data.point&&t.data.point.oreplyPointUse&&t.data.point.oreplyPointUse=="yes"&&(this.pointMsg="후기작성시 포토후기는 "+v.numberFormat(t.data.point.oreplyPhotoPoint)+t.data.point.pointUnit+" 일반후기는 "+v.numberFormat(t.data.point.oreplyPoint)+t.data.point.pointUnit+" "+t.data.point.pointName+" 지급됩니다")})},reviewValidate(){if(!this.form)return;if(!this.pid||!this.oid){this.hide();return}if(!this.grade){let e={message:"평점을 선택해주세요"};this.emitter.emit("modalOpen",e);return}if(!this.content)return;const t=new FormData;t.append("pid",this.pid),t.append("oid",this.oid),t.append("grade",this.grade),t.append("content",this.content);let s=1;for(const e of this.reviewImgs)e.file&&(t.append("img"+s,e.file),t.append("tempImgs[]",1),s++);this.emitter.emit("overlay","open"),w.postFile(U,t,e=>{if(this.emitter.emit("overlay","hide"),e.status=="success"){this.$router.back();let d={message:"구매후기가 등록되었습니다"};this.emitter.emit("modalOpen",d)}else{let d="";switch(e.data){case"is":d="이미 등록된 후기입니다";break;case"denyOstatus":d="후기등록권한이 존재하지 않습니다";break}let n={message:d};this.emitter.emit("modalOpen",n)}})},insertImg(t){this.reviewImgIndex=t,this.$refs.img.click()},deleteImg(t){this.reviewImgs.splice(t,1),this.reviewImgs.length<1&&this.reviewImgs.push({isfile:"",file:null,url:""})},imgUpload(){const t=this.$refs.img.files;let s=t.length>0?t[0]:null,e={isfile:"",file:s,url:URL.createObjectURL(s)};this.reviewImgs.splice(this.reviewImgIndex,1,e),this.reviewImgIndex<3&&this.reviewImgs.push({isfile:"",file:null,url:""}),this.$refs.img.value=""},hide(){this.$router.back()}}},_=t=>(D("data-v-f7f18eb2"),t=t(),C(),t),O={class:"login-container"},M={class:"order-body"},N={class:"img-box"},B=["src"],A={class:"product-info"},T={class:"info-ul"},z={key:0},G={style:{"font-weight":"bold"}},j={key:1},W={style:{"font-weight":"bold"}},Y={class:"price"},J={key:0,class:"single-option-box"},q=_(()=>i("div",{class:"single-title"},"추가옵션",-1)),H={class:"single-option-ul"},K={class:"sopt-name"},Q={key:0,class:"sopt-price"},X={key:1,class:"sopt-soldout"},Z={class:"grade-box"},$=_(()=>i("div",{class:"gtitle",style:{"padding-top":"30px"}},"이상품은 어떠셨나요?",-1)),ee={class:"w-full"},te={class:"w-full",style:{padding:"20px 0"}},ie={class:"detail-img-box"},se={class:"add-detial-img-ul"},oe={class:"reg-img-box"},ne={key:0,class:"is-img"},le=["onClick"],ae=["src"],de=["onClick"],re={class:"guide-img-icon"},ce=_(()=>i("div",{class:"guide-img-size"},null,-1)),pe={key:0,class:"tip"},me={class:"button-row"},ue=_(()=>i("span",null,"취소",-1)),_e=_(()=>i("span",null,"확인",-1));function he(t,s,e,d,n,m){const x=u("v-rating"),P=u("v-textarea"),b=u("font-awesome-icon"),y=u("v-btn"),L=u("v-form");return l(),a("div",O,[i("ul",M,[(l(!0),a(h,null,g(n.orderList,o=>(l(),a("li",null,[i("div",N,[i("img",{src:o.listImg},null,8,B)]),i("div",A,[i("ul",T,[i("li",null,[n.oidPidList[o.oidPid]?(l(),a("div",z,[i("span",G,c(o.pname),1),(l(!0),a(h,null,g(n.oidPidList[o.oidPid],r=>(l(),a("div",null,c(r.name)+" ("+c(r.oamt)+"개) ",1))),256))])):(l(),a("div",j,[i("span",W,c(o.pname),1),E(" ("+c(o.oamt)+"개) ",1)]))])]),i("div",Y,c(n.util.numberFormat(o.productprice))+"원 ",1),o.optionSingleDatas.length>0?(l(),a("div",J,[q,i("ul",H,[(l(!0),a(h,null,g(o.optionSingleDatas,(r,f)=>(l(),a("li",{key:"spt"+f},[i("div",K,c(r.option_parent_name)+":"+c(r.option_name),1),r.status=="sale"?(l(),a("div",Q,[i("span",null,c(r.camt)+"개, "+c(n.util.numberFormat(r.sellprice))+"원 ",1)])):(l(),a("div",X," [품절] "))]))),128))])])):k("",!0)])]))),256))]),p(L,{modelValue:n.form,"onUpdate:modelValue":s[4]||(s[4]=o=>n.form=o),novalidate:"",onSubmit:R(m.reviewValidate,["prevent"])},{default:I(()=>[i("div",Z,[$,p(x,{modelValue:n.grade,"onUpdate:modelValue":s[0]||(s[0]=o=>n.grade=o),hover:"",color:"#000000","background-color":"#999",length:"5",size:"40"},null,8,["modelValue"])]),i("div",ee,[i("div",te,[p(P,{style:{"border-radius":"5px"},variant:"outlined",density:"compact",counter:"","no-resize":"",maxlength:"200",label:"",rules:[()=>!!n.content||"내용을 입력해주세요"],placeholder:"내용을 입력해주세요(최대200자)",modelValue:n.content,"onUpdate:modelValue":s[1]||(s[1]=o=>n.content=o)},null,8,["rules","modelValue"])]),i("div",ie,[i("input",{type:"file",style:{display:"none"},ref:"img",accept:"image/*",onChange:s[2]||(s[2]=(...o)=>m.imgUpload&&m.imgUpload(...o))},null,544),i("ul",se,[(l(!0),a(h,null,g(n.reviewImgs,(o,r)=>(l(),a("li",oe,[o.url?(l(),a("div",ne,[i("div",{class:"is-img-close",onClick:f=>m.deleteImg(r)},[p(b,{icon:"fa-solid fa-xmark"})],8,le),i("img",{src:o.url},null,8,ae)])):(l(),a("div",{key:1,class:"guide-img",onClick:f=>m.insertImg(r)},[i("div",re,[p(b,{icon:"fa-solid fa-plus"})]),ce],8,de))]))),256))])])]),n.pointMsg?(l(),a("div",pe,c(n.pointMsg),1)):k("",!0),i("div",me,[p(y,{type:"button",variant:"outlined",rounded:"",onClick:s[3]||(s[3]=o=>m.hide()),class:"whiteButton"},{default:I(()=>[ue]),_:1}),p(y,{type:"submit",variant:"outlined",rounded:"",class:"blackButton"},{default:I(()=>[_e]),_:1})])]),_:1},8,["modelValue","onSubmit"])])}const ye=S(F,[["render",he],["__scopeId","data-v-f7f18eb2"]]);export{ye as default};
